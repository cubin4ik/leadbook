{% extends 'dashboard/base.html' %}
{% block content %}
<article class="media content-section">
    <!--      <img class="rounded-circle article-img" src="{{ object.author.profile.image.url }}">-->
    <div class="media-body">
        <div class="d-flex bd-highlight">
            <div class="pt-2 pr-2 pb-2 flex-grow-1 bd-highlight">
                <h3>{{ company.title }} ({{ company.legal_form }})</h3>
            </div>
            <div class="p-2 bd-highlight">
                <a href="{% url 'leads:companies-update' company.pk %}" class="btn btn-outline-info float-right">
                    <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-pencil-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708l-3-3zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207l6.5-6.5zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.499.499 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11l.178-.178z"/>
                    </svg>
                </a>
            </div>
        </div>
        {% if company.title_latin %}
        <div>
            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-globe2 mr-1 text-muted" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm7.5-6.923c-.67.204-1.335.82-1.887 1.855-.143.268-.276.56-.395.872.705.157 1.472.257 2.282.287V1.077zM4.249 3.539a8.372 8.372 0 0 1-1.198-.49 7.01 7.01 0 0 1 2.276-1.52 6.7 6.7 0 0 0-.597.932 8.854 8.854 0 0 0-.48 1.079zM3.509 7.5H1.017A6.964 6.964 0 0 1 2.38 3.825c.47.258.995.482 1.565.667A13.4 13.4 0 0 0 3.508 7.5zm1.4-2.741c.808.187 1.681.301 2.591.332V7.5H4.51c.035-.987.176-1.914.399-2.741zM8.5 5.09V7.5h2.99a12.342 12.342 0 0 0-.399-2.741c-.808.187-1.681.301-2.591.332zM4.51 8.5H7.5v2.409c-.91.03-1.783.145-2.591.332a12.343 12.343 0 0 1-.4-2.741zm3.99 0v2.409c.91.03 1.783.145 2.591.332.223-.827.364-1.754.4-2.741H8.5zm-3.282 3.696A12.63 12.63 0 0 1 7.5 11.91v3.014c-.67-.204-1.335-.82-1.887-1.855a7.776 7.776 0 0 1-.395-.872zm.11 2.276a6.696 6.696 0 0 1-.598-.933 8.853 8.853 0 0 1-.481-1.079 8.38 8.38 0 0 0-1.198.49 7.01 7.01 0 0 0 2.276 1.522zm-1.383-2.964a9.083 9.083 0 0 0-1.565.667A6.963 6.963 0 0 1 1.018 8.5h2.49a13.36 13.36 0 0 0 .437 3.008zm6.728 2.964a7.009 7.009 0 0 0 2.275-1.521 8.376 8.376 0 0 0-1.197-.49 8.853 8.853 0 0 1-.481 1.078 6.688 6.688 0 0 1-.597.933zM8.5 11.909c.81.03 1.577.13 2.282.287-.12.312-.252.604-.395.872-.552 1.035-1.218 1.65-1.887 1.855V11.91zm3.555-.401c.57.185 1.095.409 1.565.667A6.963 6.963 0 0 0 14.982 8.5h-2.49a13.36 13.36 0 0 1-.437 3.008zM14.982 7.5h-2.49a13.361 13.361 0 0 0-.437-3.008 9.123 9.123 0 0 0 1.565-.667A6.963 6.963 0 0 1 14.982 7.5zM11.27 2.461c.177.334.339.694.482 1.078a8.368 8.368 0 0 0 1.196-.49 7.01 7.01 0 0 0-2.275-1.52c.218.283.418.597.597.932zm-.488 1.343c-.705.157-1.473.257-2.282.287V1.077c.67.204 1.335.82 1.887 1.855.143.268.276.56.395.872z"/>
            </svg>
            {% if company.website %}
            <a href="{{ company.website }}" target="_blank" class="text-muted">
                <small>{{ company.title_latin }}</small>
                <br>
            </a>
            {% else %}
            <small>{{ company.title_latin }}</small>
            <br>
            {% endif %}
        </div>
        <hr>
        {% endif %}
        {% if company.about %}
        <p>
            {{ company.about|linebreaks }}
        </p>
        {% endif %}
        <p>
            <strong>Status:</strong>
            {{ company.get_status_display }}
        </p>
        {% if company.partners.all %}
        <p>
            <strong>Partners:</strong>
            {% for partner in company.partners.all %}
            <a href="{% url 'leads:detail' partner.pk %}">{{ partner }}</a>{% if not forloop.last %}, {% endif %}
            {% endfor %}
        </p>
        {% endif %}
        <!--        DISCOUNT TABLE-->
        <table class="table">
            <thead>
            <tr>
                <th scope="col">Product group</th>
                <th scope="col">Discount</th>
                <th scope="col">Status</th>
                <!--                  <th scope="col">Class</th>-->
            </tr>
            </thead>
            <tbody>
            {% for discount in company.discounts.all %}
            <tr>
                <td>{{ discount.product_group.description }}</td>
                <th scope="row">{{ discount.value }} %</th>
                <td>{{ discount.status }}({{ discount.turnover_class }})</td>
                <!--                  <td>{{ discount.turnover_class }}</td>-->
            </tr>
            {% endfor %}
            </tbody>
        </table>
        <hr>
        <strong>Employees</strong>
        <a href="{% url 'leads:person-create' %}?company={{ company.id }}" class="ml-2" type="submit">
            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-plus-circle" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" d="M8 3.5a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5H4a.5.5 0 0 1 0-1h3.5V4a.5.5 0 0 1 .5-.5z"/>
                <path fill-rule="evenodd" d="M7.5 8a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1H8.5V12a.5.5 0 0 1-1 0V8z"/>
                <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
            </svg>
        </a>
        {% if company.person_set.all.count %}
        <table class="table table-borderless w-auto">
            <tbody>
            {% for person in company.person_set.all %}
            <tr>
                <td class="pl-0">
                    <a href="{% url 'leads:person-detail' person.pk %}" class="text-secondary">
                        {{ person.first_name }} {{ person.last_name }}
                    </a>
                    {% if person.is_main_contact %}
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-patch-check-fill text-info ml-1" viewBox="0 0 16 16" data-toggle="tooltip" data-placement="right" title="Main contact">
                        <path d="M10.067.87a2.89 2.89 0 0 0-4.134 0l-.622.638-.89-.011a2.89 2.89 0 0 0-2.924 2.924l.01.89-.636.622a2.89 2.89 0 0 0 0 4.134l.637.622-.011.89a2.89 2.89 0 0 0 2.924 2.924l.89-.01.622.636a2.89 2.89 0 0 0 4.134 0l.622-.637.89.011a2.89 2.89 0 0 0 2.924-2.924l-.01-.89.636-.622a2.89 2.89 0 0 0 0-4.134l-.637-.622.011-.89a2.89 2.89 0 0 0-2.924-2.924l-.89.01-.622-.636zm.287 5.984-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7 8.793l2.646-2.647a.5.5 0 0 1 .708.708z"/>
                    </svg>
                    {% endif %}
                </td>
                {% if person.get_email %}
                <td>
                    <a class="ml-3" href="mailto:{{ person.get_email }}">
                        <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-envelope" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2zm13 2.383l-4.758 2.855L15 11.114v-5.73zm-.034 6.878L9.271 8.82 8 9.583 6.728 8.82l-5.694 3.44A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.739zM1 11.114l4.758-2.876L1 5.383v5.73z"/>
                        </svg>
                    </a>
                </td>
                {% endif %}
                {% if person.get_phone %}
<!--                TODO: add a pop-up screen with all phones available if many-->
                <td>
                    <a class="ml-3 text-success" href="tel:+{{ person.get_phone }}">
                        <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-telephone-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M2.267.98a1.636 1.636 0 0 1 2.448.152l1.681 2.162c.309.396.418.913.296 1.4l-.513 2.053a.636.636 0 0 0 .167.604L8.65 9.654a.636.636 0 0 0 .604.167l2.052-.513a1.636 1.636 0 0 1 1.401.296l2.162 1.681c.777.604.849 1.753.153 2.448l-.97.97c-.693.693-1.73.998-2.697.658a17.47 17.47 0 0 1-6.571-4.144A17.47 17.47 0 0 1 .639 4.646c-.34-.967-.035-2.004.658-2.698l.97-.969z"/>
                        </svg>
                    </a>
                </td>
                {% endif %}
            </tr>
            {% endfor %}
            </tbody>
        </table>
        <!--              <ul class="list-unstyled">-->
        <!--                    {% for person in company.person_set.all %}-->
        <!--                        <li>-->
        <!--                            <a href="{% url 'leads:person-detail' person.pk %}" class="text-secondary">-->
        <!--                                {{ person.first_name }} {{ person.last_name }}-->
        <!--                            </a>-->
        <!--                            {% if person.email_set.all %}-->
        <!--                                <a class="ml-3" href="mailto:{{ person.email_set.all.first.email }}">-->
        <!--                                    <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-envelope" fill="currentColor" xmlns="http://www.w3.org/2000/svg">-->
        <!--                                      <path fill-rule="evenodd" d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2zm13 2.383l-4.758 2.855L15 11.114v-5.73zm-.034 6.878L9.271 8.82 8 9.583 6.728 8.82l-5.694 3.44A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.739zM1 11.114l4.758-2.876L1 5.383v5.73z"/>-->
        <!--                                    </svg>-->
        <!--                                </a>-->
        <!--                            {% endif %}-->
        <!--                            {% if person.phone_set.all %}-->
        <!--                                {% for phone in person.phone_set.all %}-->
        <!--                                    {% if phone.type|stringformat:"s" == 'main' %}-->
        <!--                                        <a class="ml-3 text-success" href="tel:+{{ phone.country_code }}{{ phone.area_code }}{{ phone.number }}{% if phone.extension %},{{ phone.extension }}{% endif %}">-->
        <!--                                            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-telephone-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">-->
        <!--                                                <path fill-rule="evenodd" d="M2.267.98a1.636 1.636 0 0 1 2.448.152l1.681 2.162c.309.396.418.913.296 1.4l-.513 2.053a.636.636 0 0 0 .167.604L8.65 9.654a.636.636 0 0 0 .604.167l2.052-.513a1.636 1.636 0 0 1 1.401.296l2.162 1.681c.777.604.849 1.753.153 2.448l-.97.97c-.693.693-1.73.998-2.697.658a17.47 17.47 0 0 1-6.571-4.144A17.47 17.47 0 0 1 .639 4.646c-.34-.967-.035-2.004.658-2.698l.97-.969z"/>-->
        <!--                                            </svg>-->
        <!--                                        </a>-->
        <!--                                    {% endif %}-->
        <!--                                {% endfor %}-->
        <!--                            {% endif %}-->
        <!--                        </li>-->
        <!--                    {% endfor %}-->
        <!--                </ul>-->
        {% endif %}
        <hr>
        <strong>Projects</strong>
        <a href="{% url 'business:project-create' %}?company_contractor={{ company.id }}" class="ml-2" type="submit">
            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-plus-circle" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" d="M8 3.5a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5H4a.5.5 0 0 1 0-1h3.5V4a.5.5 0 0 1 .5-.5z"/>
                <path fill-rule="evenodd" d="M7.5 8a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1H8.5V12a.5.5 0 0 1-1 0V8z"/>
                <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
            </svg>
        </a>
        {% if company.project_set.all.count %}
        <ul class="list-unstyled pt-2">
            {% for record in company.projectcompany_set.all %}
            <li><a href="{% url 'business:project-detail' record.project.pk %}" data-toggle="tooltip" data-placement="right" title="{{ record.get_role_display }}">{{ record.project }}</a></li>
            {% endfor %}
        </ul>
        <hr>
        {% endif %}
        {% if company.project_integrator.all.count %}
        <ul class="list-unstyled pt-2">
            {% for project in company.project_integrator.all %}
            <li><a href="{% url 'business:project-detail' project.pk %}">{{ project }}</a> - Integrator</li>
            {% endfor %}
        </ul>
        <hr>
        {% endif %}
        {% if company.project_end_user.all.count %}
        <ul class="list-unstyled pt-2">
            {% for project in company.project_end_user.all %}
            <li><a href="{% url 'business:project-detail' project.pk %}">{{ project }}</a> - End user</li>
            {% endfor %}
        </ul>
        <hr>
        {% endif %}
        <hr>
        <strong>History</strong>
        <a href="{% url 'business:event-create' %}?company={{ company.id }}&person={{ company.person_set.all|first }}" class="ml-2" type="submit">
            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-plus-circle" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" d="M8 3.5a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5H4a.5.5 0 0 1 0-1h3.5V4a.5.5 0 0 1 .5-.5z"/>
                <path fill-rule="evenodd" d="M7.5 8a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1H8.5V12a.5.5 0 0 1-1 0V8z"/>
                <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
            </svg>
        </a>
        {% if company.event_set.all %}
        <div class="container">
            <div class="row">
                <div class="mt-1 mr-5">
                    <ul class="timeline">
                        {% for event in company.event_set.all reversed %}
                        <li>
                            <a href="{% url 'business:event-detail' event.pk %}">{{ event.get_title_display }}</a>
                            <a href="{% url 'business:event-update' event.pk %}" class="ml-3 text-info history">
                                <svg width="0.9em" height="0.9em" viewBox="0 0 16 16" class="bi bi-pencil-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708l-3-3zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207l6.5-6.5zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.499.499 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11l.178-.178z"/>
                                </svg>
                            </a>
                            <a href="{% url 'business:event-delete' event.pk %}" class="ml-3 text-danger history">
                                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-trash" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                                    <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4L4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                                </svg>
                            </a>
                            <span class="float-right text-muted">{{ event.date|date:'F d, Y' }}</span>
<!--                            <small class="text-muted">with-->
<!--                                {% for person in event.person.all %}-->
<!--                                <a href="{% url 'leads:person-detail' person.pk %}">{{ person }}</a>{% if not forloop.last %},{% endif %}-->
<!--                                {% endfor %}-->
<!--                            </small>-->
                            <p>{{ event.description|linebreaks }}</p>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
        <!--                <ul class="list-group pt-2">-->
        <!--                  {% for event in company.event_set.all reversed %}-->
        <!--                    <span class="text-muted mb-1">{{ event.date|date:'F d, Y' }} - {{ event.task }}</span>-->
        <!--                    <li class="list-group-item">-->
        <!--                        {{ event.description }}-->
        <!--                    </li>-->
        <!--                    <br>-->
        <!--                  {% endfor %}-->
        <!--                </ul>-->
        {% endif %}
    </div>
</article>
{% endblock content %}